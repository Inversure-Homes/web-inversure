{% extends "landing/base.html" %}
{% load static %}

{% block content %}
  <main>
    <section class="hero hero--has-bg" style="background-image: linear-gradient(120deg, rgba(11, 19, 36, 0.92), rgba(11, 19, 36, 0.6)), url('{% static hero.bg_image %}');">
      <div class="container hero__inner">
        <div class="hero__content">
          <span class="hero__tag">{{ hero.tag }}</span>
          <h1>{{ hero.title }}</h1>
          <p>{{ hero.subtitle }}</p>
          <div class="stats-grid stats-grid--hero">
            {% for item in estadisticas %}
              <article class="stat-tile">
                <p class="stat-tile__label">{{ item.label }}</p>
                <h3>{{ item.value }}</h3>
                <span class="stat-tile__detail">{{ item.detail }}</span>
              </article>
            {% endfor %}
          </div>
        </div>
        <div class="hero__visual">
          <div class="hero__panel">
            <img class="hero__panel-image" src="{% static hero.panel_image %}" alt="Proyecto">
            <div class="hero__panel-card">
              <h4>{{ hero.panel_title }}</h4>
              {% if hero.panel_stats %}
                <div class="hero__panel-stats">
                  {% for stat in hero.panel_stats %}
                    <div class="hero__panel-stat">
                      <span>{{ stat.label }}</span>
                      <strong>{{ stat.value }}</strong>
                    </div>
                  {% endfor %}
                </div>
                <small>{{ hero.panel_footer }}</small>
              {% else %}
                <p>{{ hero.panel_text }}</p>
                <div class="hero__bar"><span></span></div>
                <small>{{ hero.panel_footer }}</small>
              {% endif %}
            </div>
          </div>
        </div>
      </div>
    </section>
    {% if lead_success == "inversor" %}
      <div class="container">
        <div class="lead-toast">Gracias, hemos recibido tu solicitud de inversor.</div>
      </div>
    {% elif lead_success == "oportunidad" %}
      <div class="container">
        <div class="lead-toast">Gracias, revisaremos tu propuesta en breve.</div>
      </div>
    {% endif %}

    <section class="section section--stats" id="estadisticas">
      <div class="container">
        <div class="section__header">
          <h2>Indicadores de confianza</h2>
          <p>Datos clave que resumen la trazabilidad y el control operativo del portfolio.</p>
        </div>
        <div class="stats-grid">
          {% for item in estadisticas %}
            <article class="stat-tile">
              <p class="stat-tile__label">{{ item.label }}</p>
              <h3>{{ item.value }}</h3>
              <span class="stat-tile__detail">{{ item.detail }}</span>
            </article>
          {% endfor %}
        </div>
      </div>
    </section>

    <section class="section" id="solucion">
      <div class="container">
        <div class="section__header">
          <h2>Una plataforma, toda la operación</h2>
          <p>Centraliza inversión, documentación y métricas sin perder velocidad.</p>
        </div>
        <div class="grid">
          {% for seccion in secciones %}
            <article class="card">
              {% if seccion.image %}
                <img class="card__image card__image--screenshot" src="{% static seccion.image %}" alt="{{ seccion.image_alt|default:seccion.title }}">
              {% endif %}
              <div class="card__icon">
                <i class="bi {{ seccion.icon }}"></i>
              </div>
              <h3>{{ seccion.title }}</h3>
              <p>{{ seccion.text }}</p>
            </article>
          {% endfor %}
        </div>
      </div>
    </section>

    <section class="section" id="proyectos">
      <div class="container">
        <div class="section__header">
          <h2>Proyectos</h2>
          <p>Presentación de operaciones con resultados económicos destacados.</p>
        </div>
        {% if proyectos %}
          <div class="project-grid">
            {% for proyecto in proyectos %}
              <article class="project-card">
                <div class="project-card__media">
                  <div class="project-card__media-bg" style="background-image: linear-gradient(160deg, rgba(13, 22, 40, 0.47), rgba(13, 22, 40, 0.18)), url('{% if proyecto.imagen_url %}{{ proyecto.imagen_url }}{% else %}{% static proyecto.imagen %}{% endif %}'); background-position: {{ proyecto.imagen_focus_x|default:50 }}% {{ proyecto.imagen_focus_y|default:50 }}%;"></div>
                </div>
                <div class="project-card__body">
                  <h3>{{ proyecto.titulo }}</h3>
                  <div class="project-card__metrics">
                    <div>
                      <span>Beneficio neto</span>
                      <strong>{{ proyecto.beneficio_neto_pct }}</strong>
                    </div>
                    <div>
                      <span>Plazo</span>
                      <strong>{{ proyecto.plazo }}</strong>
                    </div>
                  </div>
                  {% if proyecto.estado %}
                    <span class="project-card__tag">{{ proyecto.estado }}</span>
                  {% endif %}
                </div>
              </article>
            {% endfor %}
          </div>
        {% else %}
          <p class="section__note">Publicaremos aquí las operaciones cerradas con su rentabilidad final.</p>
        {% endif %}
      </div>
    </section>

    <section class="section" id="quienes-somos">
      <div class="container">
        <div class="section__split">
          <div>
            <h2>Quienes somos</h2>
            <p>{{ quienes_somos.intro }}</p>
            <p>{{ quienes_somos.historia }}</p>
            <p>{{ quienes_somos.equipo }}</p>
            <p>{{ quienes_somos.valores }}</p>
          </div>
          <div class="stat-card">
            <div>
              <span>Equipo</span>
              <strong>Operativo + Inversión</strong>
            </div>
            <div>
              <span>Foco</span>
              <strong>Transparencia total</strong>
            </div>
            <div>
              <span>Metodo</span>
              <strong>Datos + control</strong>
            </div>
          </div>
        </div>
      </div>
    </section>

    <div class="lead-modal" id="lead_modal_inversor" aria-hidden="true" data-lead-modal="inversor" {% if lead_error and lead_error.tipo == "inversor" %}data-open="true"{% endif %}>
      <div class="lead-modal__backdrop" data-lead-close></div>
      <div class="lead-modal__panel" role="dialog" aria-modal="true" aria-label="Formulario inversor">
        <button type="button" class="lead-modal__close" data-lead-close aria-label="Cerrar">×</button>
        <form class="lead-form" method="post" action="">
          {% csrf_token %}
          <input type="hidden" name="lead_tipo" value="inversor">
          <input type="hidden" name="lead_token" value="{{ lead_token }}">
          <label class="lead-form__hp">
            Empresa
            <input type="text" name="website" tabindex="-1" autocomplete="off">
          </label>
          <div class="lead-form__header">
            <h3>Quiero invertir</h3>
            <p>Cuéntanos tu perfil y nos pondremos en contacto con oportunidades activas.</p>
          </div>
          {% if lead_error and lead_error.tipo == "inversor" %}
            <div class="lead-form__error">Revisa los campos obligatorios y vuelve a intentarlo.</div>
          {% endif %}
          <label>
            Nombre
            <input type="text" name="nombre" required>
          </label>
          <label>
            Email
            <input type="email" name="email" required>
          </label>
          <div class="lead-form__row">
            <label>
              Teléfono
              <input type="text" name="telefono">
            </label>
            <label>
              Capital estimado
              <input type="text" name="capital" placeholder="Ej. 50.000 - 100.000">
            </label>
          </div>
          <label>
            Mensaje
            <textarea name="mensaje" rows="3" required></textarea>
          </label>
          <button type="submit" class="btn-solid">Quiero participar</button>
        </form>
      </div>
    </div>

    <div class="lead-modal" id="lead_modal_oportunidad" aria-hidden="true" data-lead-modal="oportunidad" {% if lead_error and lead_error.tipo == "oportunidad" %}data-open="true"{% endif %}>
      <div class="lead-modal__backdrop" data-lead-close></div>
      <div class="lead-modal__panel" role="dialog" aria-modal="true" aria-label="Formulario oportunidad">
        <button type="button" class="lead-modal__close" data-lead-close aria-label="Cerrar">×</button>
        <form class="lead-form" method="post" action="">
          {% csrf_token %}
          <input type="hidden" name="lead_tipo" value="oportunidad">
          <input type="hidden" name="lead_token" value="{{ lead_token }}">
          <label class="lead-form__hp">
            Empresa
            <input type="text" name="website" tabindex="-1" autocomplete="off">
          </label>
          <div class="lead-form__header">
            <h3>Propón un proyecto</h3>
            <p>Si eres inmobiliaria, freelance o propietario, comparte tu oportunidad.</p>
          </div>
          {% if lead_error and lead_error.tipo == "oportunidad" %}
            <div class="lead-form__error">Revisa los campos obligatorios y vuelve a intentarlo.</div>
          {% endif %}
          <label>
            Nombre
            <input type="text" name="nombre" required>
          </label>
          <label>
            Email
            <input type="email" name="email" required>
          </label>
          <div class="lead-form__row">
            <label>
              Teléfono
              <input type="text" name="telefono">
            </label>
            <label>
              Ubicación / activo
              <input type="text" name="ubicacion" required placeholder="Ej. Málaga, piso 2 hab.">
            </label>
          </div>
          <label>
            Mensaje
            <textarea name="mensaje" rows="3" required></textarea>
          </label>
          <button type="submit" class="btn-solid">Enviar propuesta</button>
        </form>
      </div>
    </div>

    <section class="section" id="reseñas">
      <div class="container">
        <div class="section__header">
          <h2>Google Business & opiniones</h2>
          <p>Historias reales de inversores que confían en nuestro método.</p>
        </div>
        <div class="reviews-grid">
          {% for review in reseñas %}
            <article class="review-card">
              <div class="review-card__header">
                <span class="review-card__name">{{ review.nombre }}</span>
                <span class="review-card__stars">★★★★★</span>
              </div>
              <p>{{ review.texto }}</p>
            </article>
          {% endfor %}
        </div>
        <div class="review-cta">
          <a class="btn-outline" href="#" aria-disabled="true">Ver reseñas en Google (próximamente)</a>
        </div>
      </div>
    </section>

    <section class="section section--sponsors" id="patrocinadores">
      <div class="container">
        <div class="section__header">
          <h2>Patrocinadores y colaboradores</h2>
          <p>Alianzas estratégicas que fortalecen nuestra operación.</p>
        </div>
        <div class="sponsor-grid">
          {% for item in patrocinadores %}
            <div class="sponsor-logo">
              <img src="{% static item.src %}" alt="{{ item.alt }}">
            </div>
          {% endfor %}
        </div>
      </div>
    </section>

    <section class="section" id="noticias">
      <div class="container">
        <div class="section__header">
          <h2>Noticias y novedades</h2>
          <p>Actualizaciones del mercado, inversiones y operaciones relevantes.</p>
        </div>
        <div class="news-grid">
          {% for noticia in noticias %}
            <article class="news-card">
              <div class="news-card__header">
                <span>{{ noticia.fecha_publicacion|date:"d M Y" }}</span>
                <span>{{ noticia.autor|default:"Equipo Inversure" }}</span>
              </div>
              {% if noticia.slug %}
                <h3><a href="{% url 'landing:noticia_detail' noticia.slug %}">{{ noticia.titulo }}</a></h3>
              {% else %}
                <h3>{{ noticia.titulo }}</h3>
              {% endif %}
              <p>{{ noticia.extracto|default:noticia.cuerpo|truncatewords:26 }}</p>
            </article>
          {% empty %}
            <div class="news-card">
              <h3>Próximamente</h3>
              <p>Estamos preparando nuevas publicaciones para mejorar el contenido SEO.</p>
            </div>
          {% endfor %}
        </div>
      </div>
    </section>
  </main>
{% endblock %}
