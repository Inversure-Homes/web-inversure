{% extends "core/base.html" %}

{% block page_header %}
  <h1 class="mb-2">Dashboard</h1>
  <p class="text-muted">Resumen global de inversión, operaciones y resultados.</p>
{% endblock %}

{% block content %}
  <div class="card shadow-sm border-0">
    <div class="card-body">
      <div class="dashboard-metrics">
        <div class="metric">
          <span>Inversores activos</span>
          <strong>{{ dashboard_stats.inversores_activos }}</strong>
        </div>
        <div class="metric">
          <span>Inversores con cuota paga</span>
          <strong>{{ dashboard_stats.inversores_cuota }}</strong>
        </div>
        <div class="metric">
          <span>Capital en vigor</span>
          <strong>{{ dashboard_stats_fmt.capital_en_vigor }}</strong>
        </div>
        <div class="metric">
          <span>Capital acumulado</span>
          <strong>{{ dashboard_stats_fmt.capital_acumulado }}</strong>
        </div>
        <div class="metric">
          <span>Operaciones</span>
          <strong>{{ dashboard_stats.operaciones }}</strong>
        </div>
      </div>

      <div class="row g-3 mt-2">
        <div class="col-md-6">
          <div class="border rounded-3 p-3 h-100">
            <h6 class="text-uppercase text-muted mb-2">Operaciones cerradas</h6>
            <div class="d-flex justify-content-between align-items-center mb-2">
              <span class="text-muted">Beneficio bruto (total)</span>
              <strong>{{ dashboard_stats_fmt.beneficio_cerrado_bruto }}</strong>
            </div>
            <div class="d-flex justify-content-between align-items-center mb-2">
              <span class="text-muted">Beneficio neto (total)</span>
              <strong>{{ dashboard_stats_fmt.beneficio_cerrado_neto }}</strong>
            </div>
            <div class="d-flex justify-content-between align-items-center mb-2">
              <span class="text-muted">Beneficio bruto medio</span>
              <strong>{{ dashboard_stats_fmt.beneficio_cerrado_bruto_medio }}</strong>
            </div>
            <div class="d-flex justify-content-between align-items-center mb-2">
              <span class="text-muted">Beneficio neto medio</span>
              <strong>{{ dashboard_stats_fmt.beneficio_cerrado_neto_medio }}</strong>
            </div>
            <div class="d-flex justify-content-between align-items-center mb-2">
              <span class="text-muted">% bruto total</span>
              <strong>{{ dashboard_stats_fmt.beneficio_cerrado_roi_bruto_total }}</strong>
            </div>
            <div class="d-flex justify-content-between align-items-center mb-2">
              <span class="text-muted">% neto total</span>
              <strong>{{ dashboard_stats_fmt.beneficio_cerrado_roi_neto_total }}</strong>
            </div>
            <div class="d-flex justify-content-between align-items-center mb-2">
              <span class="text-muted">% bruto medio</span>
              <strong>{{ dashboard_stats_fmt.beneficio_cerrado_roi_bruto_medio }}</strong>
            </div>
            <div class="d-flex justify-content-between align-items-center">
              <span class="text-muted">% neto medio</span>
              <strong>{{ dashboard_stats_fmt.beneficio_cerrado_roi_neto_medio }}</strong>
            </div>
          </div>
        </div>

        <div class="col-md-6">
          <div class="border rounded-3 p-3 h-100">
            <h6 class="text-uppercase text-muted mb-2">Operaciones abiertas</h6>
            <div class="d-flex justify-content-between align-items-center mb-2">
              <span class="text-muted">Beneficio estimado bruto</span>
              <strong>{{ dashboard_stats_fmt.beneficio_abierto_bruto }}</strong>
            </div>
            <div class="d-flex justify-content-between align-items-center">
              <span class="text-muted">Beneficio estimado neto</span>
              <strong>{{ dashboard_stats_fmt.beneficio_abierto_neto }}</strong>
            </div>
          </div>
        </div>
      </div>

      <div class="dashboard-chart">
        {% for item in beneficios_chart %}
          <div class="chart-row">
            <span class="chart-label">{{ item.nombre }}</span>
            <div class="chart-bar">
              <span style="width: {{ item.pct|floatformat:0 }}%;"></span>
            </div>
            <span class="chart-value">{{ item.valor_fmt }}</span>
          </div>
        {% empty %}
          <div class="text-muted">Sin datos de beneficios todavía.</div>
        {% endfor %}
      </div>

      <div class="mt-4">
        <h6 class="text-uppercase text-muted mb-2">Proyectos y estado</h6>
        <div class="table-responsive">
          <table class="table table-sm align-middle mb-2">
            <thead>
              <tr>
                <th>Proyecto</th>
                <th>Estado</th>
              </tr>
            </thead>
            <tbody>
              {% for p in proyectos_estado %}
                <tr>
                  <td>{{ p.nombre }}</td>
                  <td>{{ p.estado_label }}</td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
        <small class="text-muted">Leyenda: Captación, Comprado, Comercialización, Reservado, Vendido, Cerrado o Descartado.</small>
      </div>
    </div>
  </div>
{% endblock %}
