{% extends "core/base.html" %}

{% block title %}Inversure ¬∑ Simulador{% endblock %}

{% block content %}
  <h1 class="page-title">Simulador de operaciones</h1>
  <p class="page-subtitle">Introduce los datos para calcular rentabilidad y m√©tricas clave.</p>

  <form method="post">
    {% csrf_token %}

    <div class="card">
      <h2>1Ô∏è‚É£ Datos principales</h2>
      <div class="grid">
        <div class="field">
          <label>Precio compra</label>
          <input type="number" step="0.01" name="precio_compra">
        </div>
        <div class="field">
          <label>Precio venta</label>
          <input type="number" step="0.01" name="precio_venta">
        </div>
        <div class="field">
          <label>Meses de la operaci√≥n</label>
          <input type="number" step="1" name="meses">
        </div>
        <div class="field">
          <label>% Financiaci√≥n</label>
          <input type="number" step="0.01" name="financiacion">
        </div>
      </div>
    </div>

    <div class="card">
      <h2>2Ô∏è‚É£ Gastos de adquisici√≥n</h2>
      <p class="help">ITP (2%), notar√≠a (0,2%) y registro (0,2%) se calcular√°n autom√°ticamente en la l√≥gica.</p>
      <div class="grid">
        <div class="field">
          <label>Gestor√≠a compra</label>
          <input type="number" step="0.01" name="gestoria_compra">
        </div>
        <div class="field">
          <label>Captaci√≥n / reservas</label>
          <input type="number" step="0.01" name="captacion">
        </div>
        <div class="field">
          <label>Otros gastos adquisici√≥n</label>
          <input type="number" step="0.01" name="otros_adquisicion">
        </div>
      </div>
    </div>

    <div class="card">
      <h2>3Ô∏è‚É£ Inversi√≥n inicial</h2>
      <div class="grid">
        <div class="field">
          <label>Reforma</label>
          <input type="number" step="0.01" name="reforma">
        </div>
        <div class="field">
          <label>Limpieza inicial</label>
          <input type="number" step="0.01" name="limpieza_inicial">
        </div>
        <div class="field">
          <label>Mobiliario</label>
          <input type="number" step="0.01" name="mobiliario">
        </div>
        <div class="field">
          <label>Otros puesta en marcha</label>
          <input type="number" step="0.01" name="otros_puesta_marcha">
        </div>
      </div>
    </div>

    <div class="card">
      <h2>4Ô∏è‚É£ Gastos recurrentes</h2>
      <div class="grid">
        <div class="field">
          <label>Comunidad</label>
          <input type="number" step="0.01" name="comunidad">
        </div>
        <div class="field">
          <label>IBI</label>
          <input type="number" step="0.01" name="ibi">
        </div>
        <div class="field">
          <label>Seguros</label>
          <input type="number" step="0.01" name="seguros">
        </div>
        <div class="field">
          <label>Suministros</label>
          <input type="number" step="0.01" name="suministros">
        </div>
        <div class="field">
          <label>Limpieza peri√≥dica</label>
          <input type="number" step="0.01" name="limpieza_periodica">
        </div>
        <div class="field">
          <label>Ocupas / incidencias</label>
          <input type="number" step="0.01" name="ocupas">
        </div>
        <div class="field">
          <label>Otros recurrentes</label>
          <input type="number" step="0.01" name="otros_recurrentes">
        </div>
      </div>
    </div>

    <div class="card">
      <h2>5Ô∏è‚É£ Gastos de venta</h2>
      <div class="grid">
        <div class="field">
          <label>Plusval√≠a municipal</label>
          <input type="number" step="0.01" name="plusvalia">
        </div>
        <div class="field">
          <label>Inmobiliaria</label>
          <input type="number" step="0.01" name="inmobiliaria">
        </div>
        <div class="field">
          <label>Gestor√≠a venta</label>
          <input type="number" step="0.01" name="gestoria_venta">
        </div>
        <div class="field">
          <label>Otros gastos venta</label>
          <input type="number" step="0.01" name="otros_venta">
        </div>
      </div>
    </div>

    <div class="actions">
      <button class="btn" type="submit">Calcular operaci√≥n</button>
      <span class="pill">ROI m√≠nimo objetivo: 15%</span>
    </div>
  </form>

  {% if resultado %}
    <div class="card">
      <h2>üìä Resultados</h2>

      <div class="kpis">
        <div class="kpi">
          <div class="label">Inversi√≥n total</div>
          <div class="value">{{ resultado.inversion_total }} ‚Ç¨</div>
        </div>
        <div class="kpi">
          <div class="label">Beneficio bruto</div>
          <div class="value">{{ resultado.beneficio_bruto }} ‚Ç¨</div>
        </div>
        <div class="kpi">
          <div class="label">Beneficio part√≠cipes</div>
          <div class="value">{{ resultado.beneficio_participes }} ‚Ç¨</div>
        </div>
        <div class="kpi">
          <div class="label">Rentabilidad total</div>
          <div class="value">{{ resultado.rentabilidad }} %</div>
        </div>
      </div>

      <div class="kpis" style="margin-top:12px;">
        <div class="kpi">
          <div class="label">Rentabilidad anualizada</div>
          <div class="value">{{ resultado.rentabilidad_anual }} %</div>
        </div>
        <div class="kpi">
          <div class="label">Ratio beneficio / coste</div>
          <div class="value">{{ resultado.ratio }}</div>
        </div>
        <div class="kpi">
          <div class="label">Break-even</div>
          <div class="value">{{ resultado.breakeven }} ‚Ç¨</div>
        </div>
        <div class="kpi">
          <div class="label">Colch√≥n de seguridad</div>
          <div class="value">{{ resultado.colchon }} ‚Ç¨</div>
        </div>
      </div>
    </div>
  {% endif %}
{% endblock %}
