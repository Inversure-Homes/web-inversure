{% extends "core/base.html" %}

{% block content %}
<div class="inversure-app">

  <section class="inversure-section">
    <div class="container">

      <!-- CABECERA CORPORATIVA -->
      <section class="inversure-section-header mb-5 text-center">
        <div class="inversure-section-icon mb-2">
          <i class="bi bi-folder2-open"></i>
        </div>
        <h1 class="inversure-section-title">Proyectos</h1>
        <div class="inversure-divider mx-auto"></div>
        <p class="inversure-section-subtitle mx-auto">
          Operaciones en curso y simulaciones pendientes de conversi√≥n
        </p>
      </section>

      <!-- PROYECTOS GUARDADOS -->
      <div class="card shadow-sm mb-5">
        <div class="card-body">

          <h4 class="mb-4">üìÅ Proyectos guardados</h4>

          {% if proyectos %}
            {% for proyecto in proyectos %}
              <div class="d-flex justify-content-between align-items-center py-3 border-bottom">
                <div>
                  <strong>{{ proyecto.nombre }}</strong><br>
                  <small class="text-muted">
                    Estado: {{ proyecto.estado|default:"estudio" }}
                  </small>
                </div>

                <a href="{% url 'core:simulador' proyecto.id %}"
                   class="btn btn-primary">
                  Abrir proyecto
                </a>
              </div>
            {% endfor %}
          {% else %}
            <p class="text-muted mb-0">No hay proyectos guardados.</p>
          {% endif %}

        </div>
      </div>

      <!-- SIMULACIONES PENDIENTES -->
      <div class="card shadow-sm">
        <div class="card-body">

          <h4 class="mb-4">üß™ Simulaciones pendientes</h4>

          {% if simulaciones_pendientes %}
            {% for sim in simulaciones_pendientes %}
              <div class="d-flex justify-content-between align-items-center py-3 border-bottom">

                <div>
                  <strong>{{ sim.direccion|default:"Simulaci√≥n sin direcci√≥n" }}</strong><br>
                  <small class="text-muted">
                    Compra: {{ sim.precio_compra|floatformat:2 }} ‚Ç¨ ¬∑
                    Venta: {{ sim.precio_venta_estimado|floatformat:2 }} ‚Ç¨ ¬∑
                    ROI: {{ sim.roi|floatformat:2 }} %
                  </small>
                </div>

                <div class="d-flex gap-2">
                  <form method="post"
                        action="{% url 'core:convertir_simulacion_a_proyecto' sim.id %}">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-success">
                      Convertir
                    </button>
                  </form>

                  <form method="post"
                        action="{% url 'core:borrar_simulacion' sim.id %}">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-outline-danger">
                      Borrar
                    </button>
                  </form>
                </div>

              </div>
            {% endfor %}
          {% else %}
            <p class="text-muted mb-0">No hay simulaciones pendientes.</p>
          {% endif %}

        </div>
      </div>

    </div>
  </section>

</div>
{% endblock %}